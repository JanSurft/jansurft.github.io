<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>A virtualized network with OpenBSD&#39;s vmm</title>
  <meta name="description" content="I wanted to setup a network of virtual machines on my server. Each VM shall provide its specified service on a dedicated subdomain. I need to create the VMs,...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="https://blog.hermes-technology.de/openbsd/server/virtualmachine/network/2017/06/12/vmd-for-a-virtual-server-network.html">
  <link rel="alternate" type="application/rss+xml" title="Hermes Technology Blog" href="/feed.xml">
  
  

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="theme-color" content="#ffffff">

  
  
</head>


  <body>

    
<script data-isso="//blog.hermes-technology.de/isso/" src="//blog.hermes-technology.de/isso/js/embed.min.js"></script>



<header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Hermes Technology Blog</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/projects/">Projects</a>
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

	  

	  <div class="project-nav">
	  
	  </div>

	  <div class="project-banner">
		  <img class="project-img" src="https://blog.hermes-technology.de/assets/my-openbsd-server-project-banner.svg.png" alt="My OpenBSD server"/>
		  <!--h1 class="project-title" itemprop="project banner">My OpenBSD server</h1-->

	  <!--
	  <h1 class="project-qualifier">3</h1>
	  -->
	  </div> 

	  <h1 class="project-part">Part 3 of 5:</h1>

	  	  <h1 class="post-title" itemprop="name headline">
	  

		
		

	    
	  

		
		

	    
		  <a class="arrow arrow-left" role="button" href="/openbsd/server/2017/06/06/a-first-server.html"></a>
		
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
	  
	  
	  A virtualized network with OpenBSD&#39;s vmm
	  
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  

		
		

		
		  <a class="arrow arrow-right" role="button" href="/2017/06/21/my-openbsd-server-3-making-ssh-more-secure.html"></a>
		
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  
	  </h1>
	  
    <p class="post-meta">
      <time datetime="2017-06-12T01:00:00+02:00" itemprop="datePublished">
        
        Jun 12, 2017
      </time>
      </p>
	
	
      
      <p class="author"><a href="/openbsd/server/virtualmachine/network/2017/06/12/vmd-for-a-virtual-server-network.html#isso-thread">Comments</a></p>
      
	
  
  </header>



  <div class="post-content" itemprop="articleBody">
    <p><strong>UPDATE:</strong> As I already suggested in the outlook of my last post, I wanted to exchange <code>nginx</code> with <code>relayd</code> for redirection. I did this now, thanks to <a href="https://serverfault.com/questions/856807/openbsd-how-to-use-relayd-and-httpd-for-redirecting-subdomain-requests/858849#858849">an answered question on stackoverflow</a>. See the new section: <a href="/openbsd/server/virtualmachine/network/2017/06/12/vmd-for-a-virtual-server-network.html#configuring-relayd-on-the-host-vm">Configuring relayd on the host-vm</a>.</p>
<p>Hello dear reader,</p>
<p>in my last post I described the setup of a http server which is reachable through a public domain on OpenBSD. This time I would like to go a little bit further and extend the server with a network of virtual machines, where each machine can be reached by the name of the subdomain it should represent.</p>
<h2 id="intro">Intro</h2>
<p>For this setup to work, I needed to download two files from the OpenBSD site:</p>
<ul>
<li>The installation file of the most recent OpenBSD system (at the time it was 6.1)</li>
<li>The boot file (bsd.rd)</li>
</ul>
<p>Afterwards I had to install the VM, configure it, duplicate it for the virtual network.</p>
<p>Then I had to configure the main server and everything worked like a charm in the end.</p>
<p>For better explenation I will include a similar figure as show in my last two posts.</p>
<figure>
<figcaption>
<i>Figure 1: Virtual Network on my server</i>
</figcaption>
<img src="https://blog.hermes-technology.de/assets/server-sketch-foo-bar.svg.png" title="Figure 1: Virtual Network on my server" alt="Server Infrastructure" />
</figure>
<p>You can see that there are serveral components to be configured for the virtual network to work as desired in the end:</p>
<p>I need to...:</p>
<ul>
<li>...configure <code>pf</code> for redirection and NAT</li>
<li>...configure <code>unbound</code> for acting as a DNS server</li>
<li>...create three different VMs (host-vm, foo-vm, bar-vm)</li>
<li>...connect the VMs to a virtual switch called &quot;localnet&quot;</li>
<li>...configure <code>relayd</code> on the host-vm for redirection of subdomain requests</li>
</ul>
<h3 id="outline">Outline</h3>
<p>Here a short outline to jump back and forth (turn off <code>noscript</code> for a second to see it :-) ):</p>
<div id="toc">

</div>
<h2 id="create-the-vms">Create the VMs</h2>
<p>This section will deal about creating a raw disk image and installing OpenBSD on it via the OpenBSD included <code>vmd</code> framework. This includes downloading some necessary resources and creating and installing a VM with the application called <code>vmctl</code>.</p>
<p>Afterwards the created installation will be duplicated and set up for the different VMs.</p>
<h3 id="create-the-host-vm">Create the Host VM</h3>
<h4 id="choose-my-mirror-to-download-from">Choose my mirror to download from</h4>
<p>There are many mirrors that I could choose from: listed <a href="https://www.openbsd.org/ftp.html">here</a> on the OpenBSD website.</p>
<h4 id="download-the-files">Download the files</h4>
<p>At first I located the necessary files in a webbrowser on my system. I chose the mirror in Frankfurt, so the main url was <a href="https://ftp.hostserver.de/pub/OpenBSD/" class="uri">https://ftp.hostserver.de/pub/OpenBSD/</a>.</p>
<p>There I chose the most recent OpenBSD version 6.1 and navigated to the directory for amd64 ending here: <a href="https://ftp.hostserver.de/pub/OpenBSD/6.1/amd64/" class="uri">https://ftp.hostserver.de/pub/OpenBSD/6.1/amd64/</a>.</p>
<p>The necessary files are:</p>
<ul>
<li><code>install61.fs</code> the OpenBSD installation image, that I already downloaded when I created a bootable USB Stick for my OpenBSD Installation.</li>
<li><code>bsd.rd</code> the boot image of OpenBSD.</li>
</ul>
<p>I opened an ssh-session to the server and downloaded those files via <code>ftp</code> (I'm using <code>ftp</code> now and not <code>wget</code>, as it is in base, thank you for the comment Raf):</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="bu">cd</span> ~
<span class="fu">mkdir</span> vm-network
<span class="bu">cd</span> vm-network
<span class="fu">ftp</span> https://ftp.hostserver.de/pub/OpenBSD/6.1/amd64/install61.fs
<span class="fu">ftp</span> https://ftp.hostserver.de/pub/OpenBSD/6.1/amd64/bsd.rd</code></pre></div>
<p>As PengouinBSD correctly suggested in the comments, I should also check the downloaded files:</p>
<pre><code>cd vm-network
ftp https://ftp.hostserver.de/pub/OpenBSD/6.1/amd64/SHA256.sig
signify -Cp /etc/signify/openbsd-61-base.pub -x SHA256.sig install61.fs bsd.rd</code></pre>
<p>From now on I assume you also have a folder called <code>vm-network</code> in your user's home directory.</p>
<h4 id="create-a-raw-disk-file-and-start-the-installation">Create a raw disk file and start the installation</h4>
<p>I'm located in my dedicated folder <code>vm-network</code>, where the previously downloaded files <code>install61.fs</code> and <code>bsd.rd</code> are located.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="bu">cd</span> ~/vm-network</code></pre></div>
<p>Within this folder I created a raw disk image called <code>host.drive</code> with 8GB:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl create host.drive -s 8G</code></pre></div>
<p>And started installing on this disk interactively with a console:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl start <span class="st">&quot;host-vm&quot;</span> -c -b bsd.rd -m 2G -i 1 -d host.drive -d install61.fs</code></pre></div>
<p>The options that are provided to <code>vmctl</code> mean the following:</p>
<ul>
<li><code>start &quot;host-vm&quot;</code>: start the virtual machine, naming it &quot;host-vm&quot;</li>
<li><code>-c</code>: immediately connect the console of the vm into the current shell</li>
<li><code>-b bsd.rd</code>: choose the specified image as boot kernel</li>
<li><code>-m 2G</code>: start the virtual machine with two gigabytes of memory</li>
<li><code>-i 1</code>: create a virtual network interface connected to that virtual machine</li>
<li><code>-d host.drive</code>: attach the raw disk file where to install OpenBSD on</li>
<li><code>-d install61.fs</code>: attach the image with the OpenBSD 6.1 installation files</li>
</ul>
<div class="tip">
<table>
<colgroup>
<col style="width: 100%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>A TIP TO PREVENT FUTURE HEADACHES</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>If you ever run into the problem of this annoying Error when running the command <code>vmctl start ...</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl start <span class="st">&quot;myvm&quot;</span> -i 1 -d xyz.drive
<span class="ex">vmctl</span>: start vm command failed: No such file or directory</code></pre></div>
<p>then you're probably missing the device file for the taps in <code>/dev</code>. The installer creates 4 by default, so you'll have to run...</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="bu">cd</span> /dev<span class="kw">;</span> <span class="fu">sh</span> MAKEDEV tap4</code></pre></div>
<p>...and so on for each new tap device you need.</p>
<p>I took this tip from <a href="http://openbsd-archive.7691.n7.nabble.com/vmd-upper-limit-on-number-of-vm-s-td312916.html">here</a> when I ran into a simmilar problem.</p></td>
</tr>
</tbody>
</table>
</div>
<h4 id="guided-installation-of-openbsd-for-the-host-vm">Guided Installation of OpenBSD for the host-vm</h4>
<p>In <em>Table 1</em> below I show the whole installation process and what I did including some comments.</p>
<figure>
<figcaption>
<i>Table 1: Guided Installation</i>
</figcaption>
<table>
<colgroup>
<col style="width: 56%" />
<col style="width: 21%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Terminal Output</strong></th>
<th><strong>My Input</strong></th>
<th><strong>Comments</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><pre><code>Welcome to the OpenBSD/amd64 6.1 installation program.
(I)nstall, (U)pgrade, (A)utoinstall or (S)hell?</code></pre></td>
<td><p><code>I</code></p></td>
<td><p>I want to install OpenBSD</p></td>
</tr>
<tr class="even">
<td><pre><code>Terminal type? [vt220]</code></pre></td>
<td><p><em>return</em></p></td>
<td></td>
</tr>
<tr class="odd">
<td><pre><code>System hostname? (short form, e.g. &#39;foo&#39;)</code></pre></td>
<td><p><code>host</code></p></td>
<td><p>Call it host, because it will be the host for the vm net.</p></td>
</tr>
<tr class="even">
<td><pre><code>Available network interfaces are: vio0 vlan0
Which network interface do you wish to configure? (or &#39;done&#39;) [vio0]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Yes, configure vio0.</p></td>
</tr>
<tr class="odd">
<td><pre><code>IPv4 address for vio0? (or &#39;dhcp&#39; or &#39;none&#39;) [dhcp]</code></pre></td>
<td><p><code>192.168.30.2</code></p></td>
<td><p>ip address of my vm in the virtual network</p></td>
</tr>
<tr class="even">
<td><pre><code>Netmask for vio0? [255.255.255.0]</code></pre></td>
<td><p><em>return</em></p></td>
<td></td>
</tr>
<tr class="odd">
<td><pre><code>IPv6 address for vio0? (or &#39;rtsol&#39; or &#39;none&#39;) [none]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Don't need an IPv6 address.</p></td>
</tr>
<tr class="even">
<td><pre><code>Which network interface do you wish to configure? (or &#39;done&#39;) [done]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>I'm done.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Default IPv4 route? (IPv4 address or none)</code></pre></td>
<td><p><code>192.168.30.1</code></p></td>
<td><p>The address of the router that manages my virtual network. I chose 192.168.30.1 for the subnet 192.168.30.0/24.</p></td>
</tr>
<tr class="even">
<td><pre><code>add net default: gateway 192.168.30.1</code></pre></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><pre><code>DNS domain name? (e.g. &#39;bar.com&#39;) [my.domain]</code></pre></td>
<td><p><code>hermes-technology.de</code></p></td>
<td><p>The root domain (In the end it will resolve to the hostname <code>host.hermes-technology.de</code>.</p></td>
</tr>
<tr class="even">
<td><pre><code>DNS nameservers? (IP address list or &#39;none&#39;) [none]</code></pre></td>
<td><p><code>192.168.30.1</code></p></td>
<td><p>My DNS nameserver should be serving on the virtual NIC with that IP.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Password for root account? (will not echo)
Password for root account? (again)</code></pre></td>
<td><p>2x <code>mypasswd</code></p></td>
<td><p>I did choose another password of course.. :D</p></td>
</tr>
<tr class="even">
<td><pre><code>Start sshd(8) by default? [yes]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Yes I want to connect via ssh later on.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Change the default console to com0? [yes]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>sure...</p></td>
</tr>
<tr class="even">
<td><pre><code>Which speed should com0 use? (or &#39;done&#39;) [9600]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>definitely...</p></td>
</tr>
<tr class="odd">
<td><pre><code>Setup a user? (enter a lower-case loginname, or &#39;no&#39;) [no]</code></pre></td>
<td><p><code>host</code></p></td>
<td><p>I want the user called &quot;host&quot;</p></td>
</tr>
<tr class="even">
<td><pre><code>Full name for user host? [host]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Don't need a full name -.-</p></td>
</tr>
<tr class="odd">
<td><pre><code>Password for user host? (will not echo)
Password for user host? (again)</code></pre></td>
<td><p>2x <code>mypasswd</code></p></td>
<td><p>Another safe password...</p></td>
</tr>
<tr class="even">
<td><pre><code>WARNING: root is targeted by password guessing attacks, pubkeys are safer.
Allow root ssh login? (yes, no, prohibit-password) [no]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>I don't want to support a direct root login via ssh.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Available disks are: sd0 sd1.
Which disk is the root disk? (&#39;?&#39; for details) [sd0]</code></pre></td>
<td><p><code>?</code></p></td>
<td><p>List me the disks!</p></td>
</tr>
<tr class="even">
<td><pre><code>sd0: Block Device (8.0G)
sd1: Block Device (0.3G)</code></pre></td>
<td></td>
<td>Ok it seems the sd0 with 8G is the one I want.</td>
</tr>
<tr class="odd">
<td><pre><code>Available disks are: sd0 sd1.
Which disk is the root disk? (&#39;?&#39; for details) [sd0]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Yes, take sd0.</p></td>
</tr>
<tr class="even">
<td><pre><code>No valid MBR or GPT.
Use (W)hole disk MBR, whole disk (G)PT or (E)dit? [whole]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Use the whole disk!</p></td>
</tr>
<tr class="odd">
<td><pre><code>Setting OpenBSD MBR partition to whole sd0...done.
The auto-allocated layout for sd0 is:
#                size           offset  fstype [fsize bsize   cpg]
  a:           131.1M               64  4.2BSD   2048 16384     1 # /
  b:           182.1M           268480    swap
  c:          8192.0M                0  unused
  d:           201.7M           641504  4.2BSD   2048 16384     1 # /tmp
  e:           212.8M          1054560  4.2BSD   2048 16384     1 # /var
  f:           951.1M          1490304  4.2BSD   2048 16384     1 # /usr
  g:           542.6M          3438080  4.2BSD   2048 16384     1 # /usr/X11R6
  h:          2150.1M          4549376  4.2BSD   2048 16384     1 # /usr/local
  i:          1044.4M          8952832  4.2BSD   2048 16384     1 # /usr/src
  j:          1340.8M         11091808  4.2BSD   2048 16384     1 # /usr/obj
  k:          1432.5M         13837856  4.2BSD   2048 16384     1 # /home
Use (A)uto layout, (E)dit auto layout, or create (C)ustom layout? [a]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Auto layout worked for me..</p></td>
</tr>
<tr class="even">
<td><pre><code>Rounding size to bsize (32 sectors): 268416
Rounding offset to bsize (32 sectors): 641504
Rounding size to bsize (32 sectors): 413056
Rounding size to bsize (32 sectors): 435744
Rounding size to bsize (32 sectors): 1947776
Rounding size to bsize (32 sectors): 1111296
Rounding size to bsize (32 sectors): 4403456
Rounding size to bsize (32 sectors): 2138976
Rounding size to bsize (32 sectors): 2746048
Rounding size to bsize (32 sectors): 2933856
/dev/rsd0a: 131.1MB in 268416 sectors of 512 bytes
4 cylinder groups of 32.77MB, 2097 blocks, 4224 inodes each
/dev/rsd0k: 1432.5MB in 2933856 sectors of 512 bytes
8 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
/dev/rsd0d: 201.7MB in 413056 sectors of 512 bytes
4 cylinder groups of 50.42MB, 3227 blocks, 6528 inodes each
/dev/rsd0f: 951.1MB in 1947776 sectors of 512 bytes
5 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
/dev/rsd0g: 542.6MB in 1111296 sectors of 512 bytes
4 cylinder groups of 135.66MB, 8682 blocks, 17408 inodes each
/dev/rsd0h: 2150.1MB in 4403456 sectors of 512 bytes
11 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
/dev/rsd0j: 1340.8MB in 2746048 sectors of 512 bytes
7 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
/dev/rsd0i: 1044.4MB in 2138976 sectors of 512 bytes
6 cylinder groups of 202.47MB, 12958 blocks, 25984 inodes each
newfs: reduced number of fragments per cylinder group from 27232 to 27120
to enlarge last cylinder group
/dev/rsd0e: 212.8MB in 435744 sectors of 512 bytes
5 cylinder groups of 52.97MB, 3390 blocks, 6784 inodes each
Available disks are: sd1.
Which disk do you wish to initialize? (or &#39;done&#39;) [done]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Don't need another disk.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Let&#39;s install the sets!
Location of sets? (disk http or &#39;done&#39;) [http]</code></pre></td>
<td><p><code>disk</code></p></td>
<td><p>Ok the sets are on the disk with &quot;install61.fs&quot; on.</p></td>
</tr>
<tr class="even">
<td><pre><code>Is the disk partition already mounted? [no]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>No the other disk is not mounted yet.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Available disks are: sd0 sd1.
Which disk contains the install media? (or &#39;done&#39;) [sd1]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Ok sd0 was the 8G so sd1 should be the one I want.</p></td>
</tr>
<tr class="even">
<td><pre><code>Which disk contains the install media? (or &#39;done&#39;) [sd1]
  a:           572416             1024  4.2BSD   2048 16384 16142
  i:              960               64   MSDOS
Available sd1 partitions are: a i.
Which sd1 partition has the install sets? (or &#39;done&#39;) [a]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>mmh, yes seems as if partition <code>a</code> contains the sets.</p></td>
</tr>
<tr class="odd">
<td><pre><code>Pathname to the sets? (or &#39;done&#39;) [6.1/amd64]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>That pathname sounds good to me</p></td>
</tr>
<tr class="even">
<td><pre><code>Select sets by entering a set name, a file name pattern or &#39;all&#39;. De-select
sets by prepending a &#39;-&#39; to the set name, file name pattern or &#39;all&#39;. Selected
sets are labelled &#39;[X]&#39;.
    [X] bsd           [X] base61.tgz    [X] game61.tgz    [X] xfont61.tgz
    [X] bsd.rd        [X] comp61.tgz    [X] xbase61.tgz   [X] xserv61.tgz
    [ ] bsd.mp        [X] man61.tgz     [X] xshare61.tgz
Set name(s)? (or &#39;abort&#39; or &#39;done&#39;) [done]</code></pre></td>
<td><p><code>all</code></p></td>
<td><p>I want them all!!</p></td>
</tr>
<tr class="odd">
<td><pre><code>    [X] bsd           [X] base61.tgz    [X] game61.tgz    [X] xfont61.tgz
    [X] bsd.rd        [X] comp61.tgz    [X] xbase61.tgz   [X] xserv61.tgz
    [X] bsd.mp        [X] man61.tgz     [X] xshare61.tgz
Set name(s)? (or &#39;abort&#39; or &#39;done&#39;) [done]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>Ok, now you can go on.</p></td>
</tr>
<tr class="even">
<td><pre><code>Directory does not contain SHA256.sig. Continue without verification? [no]</code></pre></td>
<td><p><code>yes</code></p></td>
<td><p>There is no way around that..</p></td>
</tr>
<tr class="odd">
<td><pre><code>Installing bsd          100% |**************************| 10433 KB    00:00
Installing bsd.rd       100% |**************************|  9210 KB    00:00
Installing bsd.mp       100% |**************************| 10499 KB    00:00
Installing base61.tgz   100% |**************************| 52322 KB    00:04
Extracting etc.tgz      100% |**************************|   189 KB    00:00
Installing comp61.tgz   100% |**************************| 46070 KB    00:04
Installing man61.tgz    100% |**************************|  8719 KB    00:00
Installing game61.tgz   100% |**************************|  2707 KB    00:00
Installing xbase61.tgz  100% |**************************| 17497 KB    00:01
Extracting xetc.tgz     100% |**************************|  7006       00:00
Installing xshare61.tgz 100% |**************************|  4406 KB    00:00
Installing xfont61.tgz  100% |**************************| 39342 KB    00:02
Installing xserv61.tgz  100% |**************************| 13001 KB    00:00
Location of sets? (disk http or &#39;done&#39;) [done]</code></pre></td>
<td><p><em>return</em></p></td>
<td><p>That's it with the sets.</p></td>
</tr>
<tr class="even">
<td><pre><code>What timezone are you in? (&#39;?&#39; for list) [Canada/Mountain]
Africa/      Chile/       GB-Eire      Israel       Navajo       US/
America/     Cuba         GMT          Jamaica      PRC          UTC
Antarctica/  EET          GMT+0        Japan        PST8PDT      Universal
Arctic/      EST          GMT-0        Kwajalein    Pacific/     W-SU
Asia/        EST5EDT      GMT0         Libya        Poland       WET
Atlantic/    Egypt        Greenwich    MET          Portugal     Zulu
Australia/   Eire         HST          MST          ROC          posix/
Brazil/      Etc/         Hongkong     MST7MDT      ROK          posixrules
CET          Europe/      Iceland      Mexico/      Singapore    right/
CST6CDT      Factory      Indian/      NZ           Turkey
Canada/      GB           Iran         NZ-CHAT      UCT</code></pre></td>
<td><p><code>?</code></p></td>
<td><p>Aha... ok I guess there is a Berlin in Europe...</p></td>
</tr>
<tr class="odd">
<td><pre><code>What timezone are you in? (&#39;?&#39; for list) [Canada/Mountain]</code></pre></td>
<td><p><code>Europe/Berlin</code></p></td>
<td><p>...so I take that.</p></td>
</tr>
<tr class="even">
<td><pre><code>Saving configuration files...done.
Making all device nodes...done.</code></pre></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><pre><code>CONGRATULATIONS! Your OpenBSD install has been successfully completed!
To boot the new system, enter &#39;reboot&#39; at the command prompt.
When you login to your new system the first time, please read your mail
using the &#39;mail&#39; command.</code></pre></td>
<td></td>
<td>Made it!</td>
</tr>
</tbody>
</table>
</figure>
<p>Ok now he is telling me to reboot the machine... But I can easily just choose to exit the vm via this key-sequence:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">~</span>^<span class="ex">D</span></code></pre></div>
<p>So first enter the <strong>tilde</strong> symbol and afterwards <strong>Ctrl-D</strong>.</p>
<p><em>The tilde is not supposed to apear in the terminal input.</em></p>
<p>Thereafter I stopped the created virtual machine:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl stop <span class="st">&quot;host-vm&quot;</span></code></pre></div>
<p>And made a copy of the installation:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> cp host.drive host.drive.bak</code></pre></div>
<p>I also checked if everything installed fine:</p>
<pre><code>doas vmctl start &quot;host-vm&quot; -c -i 1 -d host.drive</code></pre>
<p>It should boot into the installed system now asking you for login and password in the end.</p>
<p>I configured <code>doas</code> and added the <code>/etc/installurl</code> file as shown in my last <a href="/openbsd/server/2017/06/06/a-first-server.html#openbsd-server---install-and-set-up">post</a>.</p>
<h3 id="duplicate-the-host-vm-for-other-vms-i-want">Duplicate the Host VM for other VMs I want</h3>
<p>Now I could easily duplicate the created disk file for other needed VMs:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> cp host.drive foo.drive
<span class="ex">doas</span> cp host.drive bar.drive</code></pre></div>
<p>Afterwards I started each VM and did some adjustments (I will only show what I did for the &quot;foo&quot; vm as the &quot;bar&quot; vm will be configured analogously:</p>
<p>Starting the VM as usual:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl start <span class="st">&quot;foo-vm&quot;</span> -c -i 1 -d foo.drive</code></pre></div>
<p>Add the foo user:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> adduser</code></pre></div>
<p>I copied my terminal output:</p>
<pre><code>Couldn&#39;t find /etc/adduser.conf: creating a new adduser configuration file
Reading /etc/shells
Enter your default shell: csh ksh nologin sh [ksh]: 
Your default shell is: ksh -&gt; /bin/ksh
Default login class: authpf bgpd daemon default pbuild staff unbound 
[default]: 
Enter your default HOME partition: [/home]: 
Copy dotfiles from: /etc/skel no [/etc/skel]: 
Send welcome message?: /path/file default no [no]: 
Do not send message(s)
Prompt for passwords by default (y/n) [y]: 
Default encryption method for passwords: auto blowfish [auto]: 
Use option ``-silent&#39;&#39; if you don&#39;t want to see all warnings and questions.

Reading /etc/shells
Check /etc/master.passwd
Check /etc/group

Ok, let&#39;s go.
Don&#39;t worry about mistakes. There will be a chance later to correct any input.
Enter username []: foo
Enter full name []: 
Enter shell csh ksh nologin sh [ksh]: 
Uid [1001]: 
Login group foo [foo]: 
Login group is ``foo&#39;&#39;. Invite foo into other groups: guest no 
[no]: wheel
Login class authpf bgpd daemon default pbuild staff unbound 
[default]: 
Enter password []: 
Enter password again []: 

Name:        foo
Password:    ******
Fullname:    foo
Uid:         1001
Gid:         1001 (foo)
Groups:      foo wheel
Login Class: default
HOME:        /home/foo
Shell:       /bin/ksh
OK? (y/n) [y]: 
Added user ``foo&#39;&#39;
Copy files from /etc/skel to /home/foo
Add another user? (y/n) [y]: n
Goodbye!</code></pre>
<p>Deleted the host user:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> userdel host
<span class="ex">doas</span> rm -rf /home/host</code></pre></div>
<p>Configured the new hostname:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## /etc/hosts</span>
<span class="ex">127.0.0.1</span>       localhost
::<span class="ex">1</span>             localhost
<span class="ex">192.168.30.10</span>   foo.hermes-technology.de foo</code></pre></div>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## /etc/myname</span>
<span class="ex">foo.hermes-technology.de</span></code></pre></div>
<p>Alter the <code>/etc/hostname.vio0</code> for the correct ip (it will be 192.168.30.4 for the bar-vm):</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## /etc/hostname.vio0</span>
<span class="ex">inet</span> 192.168.30.3 255.255.255.0</code></pre></div>
<p>Then I enabled httpd to show a &quot;Hello from foo&quot; html page.</p>
<p>Refer to my last post to see how to <a href="/openbsd/server/2017/06/06/a-first-server.html#start-httpd-and-show-your-website">setup httpd for this task</a>:</p>
<p>I exited the VM.</p>
<p><strong>I did the above for each VM that I added to the virtual network.</strong></p>
<h2 id="back-on-the-main-server">Back on the main server</h2>
<p>Ok now that I had the <code>host-vm</code>, <code>foo-vm</code> and <code>bar-vm</code> successfully set up I had to do some configuration on the main server.</p>
<p>At first I created a virtual NIC that acts as a Router and DNS server to the virtual-machine-network.</p>
<p>Then I configured the internal firewall <code>pf</code> and the DNS service via <code>unbound</code>.</p>
<p>At the end I configured the virtual machines for <code>vmd</code> in <code>/etc/vm.conf</code>.</p>
<h3 id="the-virtual-network-interface-card-nic">The virtual network interface card (NIC)</h3>
<p>Creating a virtual network device was very easy in OpenBSD.</p>
<p>I just had to create a file called <code>/etc/hostname.vether0</code> and insert the desired configuration:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> -s
<span class="fu">touch</span> /etc/hostname.vether0
<span class="bu">echo</span> <span class="st">&quot;inet 192.168.30.1 255.255.255.0 NONE&quot;</span> <span class="op">&gt;</span> /etc/hostname.vether0</code></pre></div>
<p>Now on next reboot or after restarting the networking service I had the vether0 device at 192.168.30.1.</p>
<h3 id="pf---the-openbsd-firewall">PF - the OpenBSD firewall</h3>
<p>There is a configuration file for the firewall at <code>/etc/pf.conf</code>, I configured it like this:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">#       $OpenBSD: pf.conf,v 1.54 2014/08/23 05:49:42 deraadt Exp $</span>
<span class="co">#</span>
<span class="co"># See pf.conf(5) and /etc/examples/pf.conf</span>

<span class="va">int_if=</span><span class="st">&quot;{ vether0 em0 }&quot;</span>

<span class="co">##set skip on lo</span>

<span class="co">##block return  # block stateless traffic</span>
<span class="co">##pass          # establish keep-state</span>

<span class="co"># By default, do not permit remote connections to X11</span>
<span class="co">##block return in on ! lo0 proto tcp to port 6000:6010</span>

<span class="kw">set</span> <span class="ex">block-policy</span> drop
<span class="kw">set</span> <span class="ex">loginterface</span> egress
<span class="kw">set</span> <span class="ex">skip</span> on lo0

<span class="co">## act as a nat</span>
<span class="ex">match</span> in all scrub (no-df random-id max-mss 1440)
<span class="ex">match</span> out on egress inet from !(egress:network) <span class="ex">to</span> any nat-to (egress:0)

<span class="co">## allow all outgoing</span>
<span class="ex">pass</span> out quick inet
<span class="ex">pass</span> in on <span class="va">$int_if</span> inet

<span class="co">## redirect http and https to the host of the vms</span>
<span class="ex">pass</span> in on egress inet proto tcp from any to (egress) <span class="ex">port</span> { 80 443 } <span class="ex">rdr-to</span> 192.168.30.2</code></pre></div>
<p>Now incoming http traffic will be redirected to the host-vm as soon as it is up and running.</p>
<p>To apply the configuration changes I executed <code>doas pfctl -f /etc/pf.conf</code>.</p>
<p>And verified those changes via <code>doas pfctl -sr</code>.</p>
<h3 id="unbound---my-dns-name-server">unbound - my DNS name server</h3>
<p>I enabled <code>unbound</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> rcctl enable unbound</code></pre></div>
<p>And configured it the way I needed it:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="co">## /var/unbound/etc/unbound.conf                                                                                                                                                                       </span>
<span class="co"># $OpenBSD: unbound.conf,v 1.7 2016/03/30 01:41:25 sthen Exp $</span>

<span class="co">## I definately want the vether0 device act as a DNS name server for the virtual network</span>
<span class="ex">server</span>:
        <span class="ex">interface</span>: 192.168.30.1
        <span class="ex">interface</span>: 127.0.0.1
        <span class="ex">interface</span>: ::1
        <span class="co">#do-ip6: no</span>

        <span class="co"># override the default &quot;any&quot; address to send queries; if multiple</span>
        <span class="co"># addresses are available, they are used randomly to counter spoofing</span>
        <span class="co">#outgoing-interface: 192.0.2.1</span>
        <span class="co">#outgoing-interface: 2001:db8::53</span>

        <span class="ex">access-control</span>: 0.0.0.0/0 refuse
        <span class="ex">access-control</span>: 127.0.0.0/8 allow
        <span class="ex">access-control</span>: ::0/0 refuse
        <span class="ex">access-control</span>: ::1 allow
        <span class="ex">access-control</span>: 192.168.1.0/24 allow

        <span class="ex">access-control</span>: 192.168.30.0/24 allow <span class="co">## I want the virtual network to be allowed for access</span>
        
        <span class="ex">do-not-query-localhost</span>: no

        <span class="ex">hide-identity</span>: yes
        <span class="ex">hide-version</span>: yes

        <span class="co"># Uncomment to enable qname minimisation.</span>
        <span class="co"># https://tools.ietf.org/html/draft-ietf-dnsop-qname-minimisation-08</span>
        <span class="co">#</span>
        <span class="co"># qname-minimisation: yes</span>

        <span class="co"># Uncomment to enable DNSSEC validation.</span>
        <span class="co">#</span>
        <span class="co">#auto-trust-anchor-file: &quot;/var/unbound/db/root.key&quot;</span>

        <span class="co"># Serve zones authoritatively from Unbound to resolver clients.</span>
        <span class="co"># Not for external service.</span>
        <span class="co">#</span>
        <span class="co">#local-zone: &quot;local.&quot; static</span>
        <span class="co">#local-data: &quot;mycomputer.local. IN A 192.0.2.51&quot;</span>
        <span class="co">#local-zone: &quot;2.0.192.in-addr.arpa.&quot; static</span>
        <span class="co">#local-data-ptr: &quot;192.0.2.51 mycomputer.local&quot;</span>

        <span class="co"># UDP EDNS reassembly buffer advertised to peers. Default 4096.</span>
        <span class="co"># May need lowering on broken networks with fragmentation/MTU issues,</span>
        <span class="co"># particularly if validating DNSSEC.</span>
        <span class="co">#</span>
        <span class="co">#edns-buffer-size: 1480</span>

        <span class="co"># Use TCP for &quot;forward-zone&quot; requests. Useful if you are making</span>
        <span class="co"># DNS requests over an SSH port forwarding.</span>
        <span class="co">#</span>
        <span class="co">#tcp-upstream: yes</span>

        <span class="co"># DNS64 options, synthesizes AAAA records for hosts that don&#39;t have</span>
        <span class="co"># them. For use with NAT64 (PF &quot;af-to&quot;).</span>
        <span class="co">#</span>
        <span class="co">#module-config: &quot;dns64 validator iterator&quot;</span>
        <span class="co">#dns64-prefix: 64:ff9b::/96     # well-known prefix (default)</span>
        <span class="co">#dns64-synthall: no</span>

<span class="ex">remote-control</span>:
        <span class="ex">control-enable</span>: yes
        <span class="ex">control-use-cert</span>: no
        <span class="ex">control-interface</span>: /var/run/unbound.sock

<span class="ex">forward-zone</span>:
        <span class="ex">name</span>: <span class="st">&quot;.&quot;</span>
        <span class="ex">forward-addr</span>: 192.168.1.1 <span class="co">## Forward the DNS Requests to my local real router</span>
        <span class="ex">forward-addr</span>: 74.82.42.42 <span class="co"># he.net</span>
        <span class="ex">forward-addr</span>: 2001:470:20::2 <span class="co"># he.net v6</span>
        <span class="ex">forward-addr</span>: 8.8.8.8 <span class="co"># google.com</span>
        <span class="ex">forward-addr</span>: 2001:4860:4860::8888 <span class="co"># google.com v6</span>
        <span class="ex">forward-addr</span>: 208.67.222.222 <span class="co"># opendns.com</span>
        <span class="ex">forward-first</span>: yes <span class="co"># try direct if forwarder fails</span></code></pre></div>
<p>Now DNS requests from the 192.168.30.0/24 subnet will be answered by the DNS server at 192.168.30.1.</p>
<h3 id="vmd---what-goes-into-etcvm.conf">vmd - What goes into /etc/vm.conf</h3>
<p>Now my next task was to create the correct vm configuration, so that each vm would be connected to a local virtual switch managing the virtual network.</p>
<div class="sourceCode" startFrom="1"><table class="sourceCode bash numberLines"><tr class="sourceCode"><td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="sourceCode"><pre><code class="sourceCode bash"><span class="co">## /etc/vm.conf</span>
<span class="va">files=</span>  <span class="ex">/home/user/vm-network/</span> <span class="co"># our disk files are at the previously created location (change &quot;user&quot; to your username)</span>

<span class="ex">vm</span> host-vm { <span class="co"># we want a vm called &quot;host-vm&quot;</span>
        <span class="ex">memory</span> 2g <span class="co">#with 2gigs of memory</span>
        <span class="ex">disk</span> <span class="va">$files</span> host.drive <span class="co"># running the host.drive</span>
        <span class="ex">interface</span> tap { lladdr 00:00:00:00:00:02 switch localnet } <span class="co"># on a network interface with the specified MAC on the localnet switch</span>
}

<span class="ex">vm</span> foo-vm {
        <span class="ex">memory</span> 2g
        <span class="ex">disk</span> <span class="va">$files</span> foo.drive
        <span class="ex">interface</span> tap { lladdr 00:00:00:00:00:03 switch localnet }
}

<span class="ex">vm</span> bar-vm {
        <span class="ex">memory</span> 2g
        <span class="ex">disk</span> <span class="va">$files</span> bar.drive
        <span class="ex">interface</span> tap { lladdr 00:00:00:00:00:04 switch localnet }
}

<span class="ex">switch</span> localnet { <span class="co"># this is the switch called &quot;localnet&quot;</span>
        <span class="ex">add</span> vether0 <span class="co"># where the virtual interface is added to</span>
}</code></pre></td></tr></table></div>
<p>So on lines 4, 10 and 16 I configured the specific VMs and on line 22 I configured the virtual switch that the VMs network interfaces are attached to.</p>
<p>Then I enabled <code>vmd</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> rcctl enable vmd</code></pre></div>
<p>And restarted the server:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> reboot</code></pre></div>
<h3 id="configuring-relayd-on-the-host-vm">Configuring relayd on the host-vm</h3>
<p>The last task was the configuration of <code>relayd</code> on the host-vm.</p>
<p>For this I logged into the host-vm, which should have been started automatically now at reboot:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> vmctl console host-vm</code></pre></div>
<p>Then I configured relayd to redirect requests to my subdomains:</p>
<div class="sourceCode"><pre class="sourceCode ini"><code class="sourceCode ini"><span class="co"># /etc/relayd.conf                                                                                       </span>

<span class="co">## MACROS</span>

<span class="dt">host_vm</span><span class="ot">=</span><span class="dv">192</span><span class="st">.</span><span class="dv">168</span><span class="st">.</span><span class="fl">30.2</span>
<span class="dt">foo_vm</span><span class="ot">=</span><span class="dv">192</span><span class="st">.</span><span class="dv">168</span><span class="st">.</span><span class="fl">30.3</span>
<span class="dt">bar_vm</span><span class="ot">=</span><span class="dv">192</span><span class="st">.</span><span class="dv">168</span><span class="st">.</span><span class="fl">30.4</span>

<span class="co">## TABLES</span>

<span class="dt">table &lt;foo_service&gt; { $foo_vm }</span>
<span class="dt">table &lt;bar_service&gt; { $bar_vm }</span>

<span class="co">## PROTOCOLS</span>

<span class="co"># define a new http protocol called &quot;reverseproxy&quot;</span>
<span class="dt">http protocol &quot;reverseproxy&quot; {</span>
<span class="dt">        </span>
<span class="dt">        </span><span class="co"># match a request that has a Host value with &quot;foo.hermes-technology.de&quot;</span>
<span class="dt">        </span><span class="co"># and forward that to the foo_service</span>
<span class="dt">        </span><span class="co"># &quot;quick&quot; means that it will be handled as the last rule if it matches... no other will be processed</span>
<span class="dt">        match request quick header &quot;Host&quot; value &quot;foo.hermes-technology.de&quot; \</span>
<span class="dt">                forward to &lt;foo_service&gt;</span>

<span class="dt">        match request quick header &quot;Host&quot; value &quot;www.hermes-technology.de&quot; \</span>
<span class="dt">                forward to &lt;foo_service&gt;</span>
<span class="dt">        </span>
<span class="dt">        match request quick header &quot;Host&quot; value &quot;bar.hermes-technology.de&quot; \</span>
<span class="dt">                forward to &lt;bar_service&gt;</span>
<span class="dt">}</span>

<span class="co">## RELAYS</span>

<span class="co"># create a new relay called &quot;proxy&quot;</span>
<span class="co"># relays are for layer 7 (e.g. http)</span>
<span class="dt">relay &quot;proxy&quot; {</span>
<span class="dt">        </span><span class="co"># the relay should listen on the host ip on port 80</span>
<span class="dt">        listen on $host_vm port 80</span>
<span class="dt">        </span>
<span class="dt">        </span><span class="co"># use the protocol &quot;reverseproxy&quot; we defined above</span>
<span class="dt">        protocol &quot;reverseproxy&quot;</span>
<span class="dt">        </span>
<span class="dt">        </span><span class="co"># forwarding is enabled for the specified services</span>
<span class="dt">        forward to &lt;foo_service&gt; port 80</span>
<span class="dt">        forward to &lt;bar_service&gt; port 80</span>
<span class="dt">}</span></code></pre></div>
<p>The last task was to enable and start <code>relayd</code>:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="ex">doas</span> rcctl enable relayd
<span class="ex">doas</span> rcctl start relayd</code></pre></div>
<h2 id="this-does-work-now">This does work now</h2>
<p>Because I bought the domain hermes-technology.de and registered blog.hermes-technology.de as CNAME entries, the following does work:</p>
<ol type="1">
<li>Enter blog.hermes-technology.de anywhere into a webbrowser.</li>
<li>The request lands at my main server's ip (hermes-technology.de).</li>
<li>PF redirects any http requests to the host-vm on 192.168.30.2.</li>
<li><code>relayd</code> on the host-vm redirects the &quot;blog&quot; subdomain request to the ip 192.168.30.3 of the blog-vm.</li>
<li>The blog-vm and its httpd-service sends the response to its gateway 192.168.30.1</li>
<li>The response on the vether0 gets a Network Address Translation (NAT) by <code>pf</code> to the router.</li>
<li>The router sends the response to the client.</li>
</ol>
<h2 id="outlook">Outlook</h2>
<p>In the next post I will explain how I set up a proper ssh connection to my server with a public key. Which is much safer than using a password. Also I will explain how to configure ssh-tunneling so that you login to your virtual servers from the workstation where you're maintaining your server from. At last I will explain how I configured <code>pf</code> to do an ssh protection like <code>fail2ban</code> does.</p>

  </div>

   
      
      <section id="isso-thread"></section>
      
  

  

</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Hermes Technology Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Hermes Technology Blog</li><li><a class="u-email" href="mailto:mail@hermes-technology.de">mail@hermes-technology.de</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/JanSurft"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">JanSurft</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is a blog about technology. I will write about the experiences I encounter, when working on my server infrastructure, building roboter(s), or developing any kind of software on the way.
</p>
      </div>
    </div>

  </div>

</footer>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/toc.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
   $(document).ready(function() {
      $('#toc').toc({
     listType: 'ul',
   });
    });
</script>
  </body>

</html>
