<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Running Docker on an Alpine VM</title>
  <meta name="description" content="I wanted to play around with docker services.">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://blog.hermes-technology.de/2020/03/25/my-open-bsdserver-5-running-docker-on-alpine-vm.html">
  <link rel="alternate" type="application/rss+xml" title="Hermes Technology Blog" href="/feed.xml">
  
  

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="theme-color" content="#ffffff">

  
  
</head>


  <body>

    
<script data-isso="//blog.hermes-technology.de/isso/" src="//blog.hermes-technology.de/isso/js/embed.min.js"></script>



<header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/">Hermes Technology Blog</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/projects/">Projects</a>
            
          
            
            
            <a class="page-link" href="/about/">About</a>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">

	  

	  <div class="project-nav">
	  
	  </div>

	  <div class="project-banner">
		  <img class="project-img" src="http://blog.hermes-technology.de/assets/my-openbsd-server-project-banner.svg.png" alt="My OpenBSD server"/>
		  <!--h1 class="project-title" itemprop="project banner">My OpenBSD server</h1-->

	  <!--
	  <h1 class="project-qualifier">5</h1>
	  -->
	  </div> 

	  <h1 class="project-part">Part 5 of 5:</h1>

	  	  <h1 class="post-title" itemprop="name headline">
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
		  <a class="arrow arrow-left" role="button" href="/2017/06/21/my-openbsd-server-3-making-ssh-more-secure.html"></a>
		
	  

		
		

	    
	  

		
		

	    
	  

		
		

	    
	  
	  
	  Running Docker on an Alpine VM
	  
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  

		
		

		
	  
	  </h1>
	  
    <p class="post-meta">
      <time datetime="2020-03-25T00:00:00+01:00" itemprop="datePublished">
        
        Mar 25, 2020
      </time>
      </p>
	
	
      
      <p class="author"><a href="/2020/03/25/my-open-bsdserver-5-running-docker-on-alpine-vm.html#isso-thread">Comments</a></p>
      
	
  
  </header>



  <div class="post-content" itemprop="articleBody">
    <div id="toc">

</div>
<h2 id="intro">Intro</h2>
<p>Meanwhile I have update my OpenBSD Server to 6.6 so some commands look different from before (<code>vmctl</code> uses a different ordering of arguments).</p>
<h2 id="create-boot-drive">Create boot drive</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># replace v3.11 with the latest version of alpine</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="ex">doas</span> ftp https://nl.alpinelinux.org/alpine/v3.11/releases/x86_64/alpine-virt-3.11.5-x86_64.iso</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="ex">doas</span> ftp https://nl.alpinelinux.org/alpine/v3.11/releases/x86_64/alpine-virt-3.11.5-x86_64.iso.sha256</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co"># verify correct signature</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="ex">sha256</span> alpine-virt-3.11.5-x86_64.iso</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># compare to</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">cat</span> alpine-virt-3.11.5-x86_64.iso.sha256</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># create the raw disk file for alpine to install on</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="ex">doas</span> vmctl create -s 8G alpine.drive</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># start the vm with boot rom</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="ex">doas</span> vmctl start -c -B cdrom -r alpine-virt-3.11.5-x86_64.iso -d alpine.drive -m 2G -n localnet alpine-vm</span></code></pre></div>
<h2 id="run-setup-interfaces">Run <code>setup-interfaces</code></h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ex">setup-interfaces</span></span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="ex">Available</span> interfaces are: eth0.</span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="ex">Enter</span> <span class="st">&#39;?&#39;</span> for help on bridges, bonding and vlans.</span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="ex">Which</span> one do you want to initialize? (or <span class="st">&#39;?&#39;</span> or <span class="st">&#39;done&#39;</span>) [<span class="ex">eth0</span>]</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="ex">Ip</span> address for eth0? (or <span class="st">&#39;dhcp&#39;</span>, <span class="st">&#39;none&#39;</span>, <span class="st">&#39;?&#39;</span>) [<span class="ex">dhcp</span>] 192.168.30.6</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="ex">Netmask?</span> [255.255.255.0]</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="ex">Gateway?</span> (or <span class="st">&#39;none&#39;</span>) [<span class="ex">none</span>] 192.168.30.1</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="ex">Configuration</span> for eth0:</span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="va">type=</span>static</span>
<span id="cb2-16"><a href="#cb2-16"></a>  <span class="va">address=</span>192.168.30.6</span>
<span id="cb2-17"><a href="#cb2-17"></a>  <span class="va">netmask=</span>255.255.255.0</span>
<span id="cb2-18"><a href="#cb2-18"></a>  <span class="va">gateway=</span>192.168.30.1</span>
<span id="cb2-19"><a href="#cb2-19"></a></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="ex">Do</span> you want to do any manual network configuration? [no]</span></code></pre></div>
<h2 id="run-setup-dns">Run <code>setup-dns</code></h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1"></a><span class="ex">DNS</span> domain name? (e.g <span class="st">&#39;bar.com&#39;</span>) [] <span class="ex">hermes-technology.de</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="ex">DNS</span> nameserver(s)<span class="ex">?</span> [] 192.168.30.1</span></code></pre></div>
<p>run</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="ex">localhost</span>:~# setup-alpine</span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="ex">Available</span> keyboard layouts:</span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="ex">af</span>     be     cn     fi     hu     it     lk     mm     pl     sy     uz</span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="ex">al</span>     bg     cz     fo     id     jp     lt     mt     pt     th     vn</span>
<span id="cb4-6"><a href="#cb4-6"></a><span class="ex">am</span>     br     de     fr     ie     ke     lv     my     ro     tj</span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="ex">ara</span>    brai   dk     gb     il     kg     ma     ng     rs     tm</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="ex">at</span>     by     dz     ge     in     kr     md     nl     ru     tr</span>
<span id="cb4-9"><a href="#cb4-9"></a><span class="ex">az</span>     ca     ee     gh     iq     kz     me     no     se     tw</span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="ex">ba</span>     ch     epo    gr     ir     la     mk     ph     si     ua</span>
<span id="cb4-11"><a href="#cb4-11"></a><span class="ex">bd</span>     cm     es     hr     is     latam  ml     pk     sk     us</span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="ex">Select</span> keyboard layout [none]: de</span>
<span id="cb4-13"><a href="#cb4-13"></a><span class="ex">Available</span> variants: de-T3 de-deadacute de-deadgraveacute de-deadtilde de-dsb de-dsb_qwertz de-dvorak de-mac de-mac_nodeadkeys de-neo de-nodeadkeys de-qwerty de-ro de-ro_nodeadkeys de-ru de-sundeadkeys de-tr de</span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="ex">Select</span> variant []: de</span>
<span id="cb4-15"><a href="#cb4-15"></a> <span class="ex">*</span> Caching service dependencies ...</span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-17"><a href="#cb4-17"></a> <span class="ex">*</span> Setting keymap ...</span>
<span id="cb4-18"><a href="#cb4-18"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="ex">Enter</span> system hostname (short form, e.g. <span class="st">&#39;foo&#39;</span>) [<span class="ex">localhost</span>]: services</span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="ex">Available</span> interfaces are: eth0.</span>
<span id="cb4-21"><a href="#cb4-21"></a><span class="ex">Enter</span> <span class="st">&#39;?&#39;</span> for help on bridges, bonding and vlans.</span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="ex">Which</span> one do you want to initialize? (or <span class="st">&#39;?&#39;</span> or <span class="st">&#39;done&#39;</span>) [<span class="ex">eth0</span>]</span>
<span id="cb4-23"><a href="#cb4-23"></a><span class="ex">Ip</span> address for eth0? (or <span class="st">&#39;dhcp&#39;</span>, <span class="st">&#39;none&#39;</span>, <span class="st">&#39;?&#39;</span>) [<span class="ex">192.168.30.6</span>]</span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="ex">Netmask?</span> [255.255.255.0]</span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="ex">Gateway?</span> (or <span class="st">&#39;none&#39;</span>) [<span class="ex">192.168.30.1</span>]</span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="ex">Configuration</span> for eth0:</span>
<span id="cb4-27"><a href="#cb4-27"></a>  <span class="va">type=</span>static</span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="va">address=</span>192.168.30.6</span>
<span id="cb4-29"><a href="#cb4-29"></a>  <span class="va">netmask=</span>255.255.255.0</span>
<span id="cb4-30"><a href="#cb4-30"></a>  <span class="va">gateway=</span>192.168.30.1</span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="ex">Do</span> you want to do any manual network configuration? [no]</span>
<span id="cb4-32"><a href="#cb4-32"></a><span class="ex">ifup</span>: interface eth0 already configured</span>
<span id="cb4-33"><a href="#cb4-33"></a><span class="ex">DNS</span> domain name? (e.g <span class="st">&#39;bar.com&#39;</span>) [] <span class="ex">hermes-technology.de</span></span>
<span id="cb4-34"><a href="#cb4-34"></a><span class="ex">DNS</span> nameserver(s)<span class="ex">?</span> [192.168.30.1 ]</span>
<span id="cb4-35"><a href="#cb4-35"></a><span class="ex">Changing</span> password for root</span>
<span id="cb4-36"><a href="#cb4-36"></a><span class="ex">New</span> password:</span>
<span id="cb4-37"><a href="#cb4-37"></a><span class="ex">Retype</span> password:</span>
<span id="cb4-38"><a href="#cb4-38"></a><span class="ex">passwd</span>: password for root changed by root</span>
<span id="cb4-39"><a href="#cb4-39"></a><span class="ex">Which</span> timezone are you in? (<span class="st">&#39;?&#39;</span> for list) [<span class="ex">UTC</span>] Europe/Berlin</span>
<span id="cb4-40"><a href="#cb4-40"></a> <span class="ex">*</span> Starting busybox acpid ...</span>
<span id="cb4-41"><a href="#cb4-41"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-42"><a href="#cb4-42"></a> <span class="ex">*</span> Starting busybox crond ...</span>
<span id="cb4-43"><a href="#cb4-43"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-44"><a href="#cb4-44"></a><span class="ex">HTTP/FTP</span> proxy URL? (e.g. <span class="st">&#39;http://proxy:8080&#39;</span>, or <span class="st">&#39;none&#39;</span>) [<span class="ex">none</span>]</span>
<span id="cb4-45"><a href="#cb4-45"></a><span class="ex">Which</span> NTP client to run? (<span class="st">&#39;busybox&#39;</span>, <span class="st">&#39;openntpd&#39;</span>, <span class="st">&#39;chrony&#39;</span> or <span class="st">&#39;none&#39;</span>) [<span class="ex">chrony</span>]</span>
<span id="cb4-46"><a href="#cb4-46"></a> <span class="ex">*</span> service chronyd added to runlevel default</span>
<span id="cb4-47"><a href="#cb4-47"></a> <span class="ex">*</span> Caching service dependencies ...</span>
<span id="cb4-48"><a href="#cb4-48"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-49"><a href="#cb4-49"></a> <span class="ex">*</span> Starting chronyd ...</span>
<span id="cb4-50"><a href="#cb4-50"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-51"><a href="#cb4-51"></a></span>
<span id="cb4-52"><a href="#cb4-52"></a><span class="ex">Available</span> mirrors:</span>
<span id="cb4-53"><a href="#cb4-53"></a><span class="ex">1</span>) <span class="ex">dl-cdn.alpinelinux.org</span></span>
<span id="cb4-54"><a href="#cb4-54"></a><span class="ex">2</span>) <span class="ex">uk.alpinelinux.org</span></span>
<span id="cb4-55"><a href="#cb4-55"></a><span class="ex">3</span>) <span class="ex">dl-2.alpinelinux.org</span></span>
<span id="cb4-56"><a href="#cb4-56"></a><span class="ex">4</span>) <span class="ex">dl-4.alpinelinux.org</span></span>
<span id="cb4-57"><a href="#cb4-57"></a><span class="ex">5</span>) <span class="ex">dl-5.alpinelinux.org</span></span>
<span id="cb4-58"><a href="#cb4-58"></a><span class="ex">6</span>) <span class="ex">dl-8.alpinelinux.org</span></span>
<span id="cb4-59"><a href="#cb4-59"></a><span class="ex">7</span>) <span class="ex">mirror.yandex.ru</span></span>
<span id="cb4-60"><a href="#cb4-60"></a><span class="ex">8</span>) <span class="ex">mirrors.gigenet.com</span></span>
<span id="cb4-61"><a href="#cb4-61"></a><span class="ex">9</span>) <span class="ex">mirror1.hs-esslingen.de</span></span>
<span id="cb4-62"><a href="#cb4-62"></a><span class="ex">10</span>) <span class="ex">mirror.leaseweb.com</span></span>
<span id="cb4-63"><a href="#cb4-63"></a><span class="ex">11</span>) <span class="ex">mirror.fit.cvut.cz</span></span>
<span id="cb4-64"><a href="#cb4-64"></a><span class="ex">12</span>) <span class="ex">alpine.mirror.far.fi</span></span>
<span id="cb4-65"><a href="#cb4-65"></a><span class="ex">13</span>) <span class="ex">alpine.mirror.wearetriple.com</span></span>
<span id="cb4-66"><a href="#cb4-66"></a><span class="ex">14</span>) <span class="ex">mirror.clarkson.edu</span></span>
<span id="cb4-67"><a href="#cb4-67"></a><span class="ex">15</span>) <span class="ex">linorg.usp.br</span></span>
<span id="cb4-68"><a href="#cb4-68"></a><span class="ex">16</span>) <span class="ex">ftp.yzu.edu.tw</span></span>
<span id="cb4-69"><a href="#cb4-69"></a><span class="ex">17</span>) <span class="ex">mirror.aarnet.edu.au</span></span>
<span id="cb4-70"><a href="#cb4-70"></a><span class="ex">18</span>) <span class="ex">speglar.siminn.is</span></span>
<span id="cb4-71"><a href="#cb4-71"></a><span class="ex">19</span>) <span class="ex">mirrors.dotsrc.org</span></span>
<span id="cb4-72"><a href="#cb4-72"></a><span class="ex">20</span>) <span class="ex">ftp.halifax.rwth-aachen.de</span></span>
<span id="cb4-73"><a href="#cb4-73"></a><span class="ex">21</span>) <span class="ex">mirrors.tuna.tsinghua.edu.cn</span></span>
<span id="cb4-74"><a href="#cb4-74"></a><span class="ex">22</span>) <span class="ex">mirrors.ustc.edu.cn</span></span>
<span id="cb4-75"><a href="#cb4-75"></a><span class="ex">23</span>) <span class="ex">mirrors.xjtu.edu.cn</span></span>
<span id="cb4-76"><a href="#cb4-76"></a><span class="ex">24</span>) <span class="ex">mirrors.nju.edu.cn</span></span>
<span id="cb4-77"><a href="#cb4-77"></a><span class="ex">25</span>) <span class="ex">mirror.lzu.edu.cn</span></span>
<span id="cb4-78"><a href="#cb4-78"></a><span class="ex">26</span>) <span class="ex">ftp.acc.umu.se</span></span>
<span id="cb4-79"><a href="#cb4-79"></a><span class="ex">27</span>) <span class="ex">mirror.xtom.com.hk</span></span>
<span id="cb4-80"><a href="#cb4-80"></a><span class="ex">28</span>) <span class="ex">mirror.csclub.uwaterloo.ca</span></span>
<span id="cb4-81"><a href="#cb4-81"></a><span class="ex">29</span>) <span class="ex">alpinelinux.mirror.iweb.com</span></span>
<span id="cb4-82"><a href="#cb4-82"></a><span class="ex">30</span>) <span class="ex">mirror.neostrada.nl</span></span>
<span id="cb4-83"><a href="#cb4-83"></a><span class="ex">31</span>) <span class="ex">pkg.adfinis-sygroup.ch</span></span>
<span id="cb4-84"><a href="#cb4-84"></a><span class="ex">32</span>) <span class="ex">mirror.ps.kz</span></span>
<span id="cb4-85"><a href="#cb4-85"></a><span class="ex">33</span>) <span class="ex">mirror.rise.ph</span></span>
<span id="cb4-86"><a href="#cb4-86"></a><span class="ex">34</span>) <span class="ex">mirror.operationtulip.com</span></span>
<span id="cb4-87"><a href="#cb4-87"></a><span class="ex">35</span>) <span class="ex">mirrors.ircam.fr</span></span>
<span id="cb4-88"><a href="#cb4-88"></a><span class="ex">36</span>) <span class="ex">alpine.42.fr</span></span>
<span id="cb4-89"><a href="#cb4-89"></a><span class="ex">37</span>) <span class="ex">mirror.math.princeton.edu</span></span>
<span id="cb4-90"><a href="#cb4-90"></a><span class="ex">38</span>) <span class="ex">mirrors.sjtug.sjtu.edu.cn</span></span>
<span id="cb4-91"><a href="#cb4-91"></a><span class="ex">39</span>) <span class="ex">alpine.mirror.didstopia.com</span></span>
<span id="cb4-92"><a href="#cb4-92"></a><span class="ex">40</span>) <span class="ex">ftp.icm.edu.pl</span></span>
<span id="cb4-93"><a href="#cb4-93"></a><span class="ex">41</span>) <span class="ex">mirror.ungleich.ch</span></span>
<span id="cb4-94"><a href="#cb4-94"></a><span class="ex">42</span>) <span class="ex">alpine.mirror.vexxhost.ca</span></span>
<span id="cb4-95"><a href="#cb4-95"></a><span class="ex">43</span>) <span class="ex">sjc.edge.kernel.org</span></span>
<span id="cb4-96"><a href="#cb4-96"></a><span class="ex">44</span>) <span class="ex">ewr.edge.kernel.org</span></span>
<span id="cb4-97"><a href="#cb4-97"></a><span class="ex">45</span>) <span class="ex">ams.edge.kernel.org</span></span>
<span id="cb4-98"><a href="#cb4-98"></a><span class="ex">46</span>) <span class="ex">download.nus.edu.sg</span></span>
<span id="cb4-99"><a href="#cb4-99"></a></span>
<span id="cb4-100"><a href="#cb4-100"></a><span class="ex">r</span>) <span class="ex">Add</span> random from the above list</span>
<span id="cb4-101"><a href="#cb4-101"></a><span class="ex">f</span>) <span class="ex">Detect</span> and add fastest mirror from above list</span>
<span id="cb4-102"><a href="#cb4-102"></a><span class="ex">e</span>) <span class="ex">Edit</span> /etc/apk/repositories with text editor</span>
<span id="cb4-103"><a href="#cb4-103"></a></span>
<span id="cb4-104"><a href="#cb4-104"></a><span class="ex">Enter</span> mirror number (1-46) <span class="ex">or</span> URL to add (or r/f/e/done) [<span class="ex">1</span>]:</span>
<span id="cb4-105"><a href="#cb4-105"></a><span class="ex">Added</span> mirror dl-cdn.alpinelinux.org</span>
<span id="cb4-106"><a href="#cb4-106"></a><span class="ex">Updating</span> repository indexes... done.</span>
<span id="cb4-107"><a href="#cb4-107"></a><span class="ex">Which</span> SSH server? (<span class="st">&#39;openssh&#39;</span>, <span class="st">&#39;dropbear&#39;</span> or <span class="st">&#39;none&#39;</span>) [<span class="ex">openssh</span>]</span>
<span id="cb4-108"><a href="#cb4-108"></a> <span class="ex">*</span> service sshd added to runlevel default</span>
<span id="cb4-109"><a href="#cb4-109"></a> <span class="ex">*</span> Caching service dependencies ...</span>
<span id="cb4-110"><a href="#cb4-110"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-111"><a href="#cb4-111"></a><span class="ex">ssh-keygen</span>: generating new host keys: RSA DSA ECDSA ED25519</span>
<span id="cb4-112"><a href="#cb4-112"></a> <span class="ex">*</span> Starting sshd ...</span>
<span id="cb4-113"><a href="#cb4-113"></a><span class="bu"> [</span> ok<span class="bu"> ]</span></span>
<span id="cb4-114"><a href="#cb4-114"></a><span class="ex">Available</span> disks are:</span>
<span id="cb4-115"><a href="#cb4-115"></a>  <span class="ex">vda</span>   (8.6 GB 0x0b5d )</span>
<span id="cb4-116"><a href="#cb4-116"></a><span class="ex">Which</span> disk(s) <span class="ex">would</span> you like to use? (or <span class="st">&#39;?&#39;</span> for help or <span class="st">&#39;none&#39;</span>) [<span class="ex">none</span>] vda</span>
<span id="cb4-117"><a href="#cb4-117"></a><span class="ex">The</span> following disk is selected:</span>
<span id="cb4-118"><a href="#cb4-118"></a>  <span class="ex">vda</span>   (8.6 GB 0x0b5d )</span>
<span id="cb4-119"><a href="#cb4-119"></a><span class="ex">How</span> would you like to use it? (<span class="st">&#39;sys&#39;</span>, <span class="st">&#39;data&#39;</span>, <span class="st">&#39;lvm&#39;</span> or <span class="st">&#39;?&#39;</span> for help) [<span class="ex">?</span>] sys</span>
<span id="cb4-120"><a href="#cb4-120"></a><span class="ex">WARNING</span>: The following disk(s) <span class="ex">will</span> be erased:</span>
<span id="cb4-121"><a href="#cb4-121"></a>  <span class="ex">vda</span>   (8.6 GB 0x0b5d )</span>
<span id="cb4-122"><a href="#cb4-122"></a><span class="ex">WARNING</span>: Erase the above disk(s) <span class="ex">and</span> continue? [y/N]: y</span>
<span id="cb4-123"><a href="#cb4-123"></a><span class="ex">Creating</span> file systems...</span>
<span id="cb4-124"><a href="#cb4-124"></a><span class="ex">Installing</span> system on /dev/vda3:</span>
<span id="cb4-125"><a href="#cb4-125"></a><span class="ex">/mnt/boot</span> is device /dev/vda1</span>
<span id="cb4-126"><a href="#cb4-126"></a><span class="ex">100%</span> <span class="co">############################################==&gt; initramfs: creating /boot/initramfs-virt</span></span>
<span id="cb4-127"><a href="#cb4-127"></a><span class="ex">/boot</span> is device /dev/vda1</span>
<span id="cb4-128"><a href="#cb4-128"></a></span>
<span id="cb4-129"><a href="#cb4-129"></a><span class="ex">Installation</span> is complete. Please reboot.</span></code></pre></div>
<p>Now run <code>exit</code> and hit <code>~^D</code> to exit the virtual terminal.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a><span class="ex">doas</span> vmctl stop alpine-vm</span></code></pre></div>
<h2 id="create-separate-data-disk-and-modify-vm.conf-and-restart-vmd">Create separate data disk and Modify <code>vm.conf</code> and restart <code>vmd</code></h2>
<p>data disk</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a><span class="ex">doas</span> vmctl create -s 20G /mnt/data/vm-drives/alpine-data.img</span></code></pre></div>
<p>Modify <code>vm.conf</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb7-1"><a href="#cb7-1"></a><span class="dt">files</span><span class="ot">=</span><span class="st">  /home/web-spider/vm/</span></span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="dt">data</span><span class="ot">=</span><span class="st">   /mnt/data/vm-drives/</span></span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="dt">vm host-vm {</span></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="dt">    memory 2g</span></span>
<span id="cb7-7"><a href="#cb7-7"></a><span class="dt">    disk $files host.drive</span></span>
<span id="cb7-8"><a href="#cb7-8"></a><span class="dt">    interface tap { lladdr 00:00:00:00:00:02 switch localnet }</span></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="dt">}</span></span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a><span class="dt">vm alpine-vm {</span></span>
<span id="cb7-12"><a href="#cb7-12"></a><span class="dt">    memory 2g</span></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="dt">    interface tap { lladdr 00:00:00:00:00:06 switch localnet }</span></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="dt">    disk &quot;/mnt/data/vm-drives/alpine.drive&quot; format raw</span></span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="dt">    disk &quot;/mnt/data/vm-drives/alpine-data.img&quot; format raw</span></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="dt">}</span></span>
<span id="cb7-17"><a href="#cb7-17"></a></span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="dt">switch localnet {</span></span>
<span id="cb7-20"><a href="#cb7-20"></a><span class="dt">    interface bridge0</span></span>
<span id="cb7-21"><a href="#cb7-21"></a><span class="dt">}</span></span></code></pre></div>
<p>Restart <code>vmd</code></p>
<pre><code>doas rcctl restart vmd</code></pre>
<h2 id="inside-alpine-vm">Inside alpine vm</h2>
<ol type="1">
<li>Connect to alpine-vm via <code>doas vmctl console alpine-vm</code></li>
<li>Update config file extlinux.conf</li>
</ol>
<p>!! Everything inside tags <code>&lt;...&gt;</code> must be substituted by your values !!</p>
<pre><code>SERIAL 0 115200
DEFAULT &lt;dist&gt;
PROMPT 0
LABEL &lt;dist&gt;
  MENU LABEL Linux &lt;dist&gt;
  LINUX vmlinuz-&lt;dist&gt;
  INITRD initramfs-&lt;dist&gt;
  APPEND root=UUID=&lt;uuid&gt; modules=sd-mod,usb-storage,ext4 rootfstype=ext4 console=ttyS0,115200</code></pre>
<p>And example might look like this:</p>
<pre><code>SERIAL 0 115200
DEFAULT hardened
PROMPT 0
LABEL hardened
  MENU LABEL Linux hardened
  LINUX vmlinuz-hardened
  INITRD initramfs-hardened
  APPEND root=UUID=001c5e4f-af70-4f6f-bdbc-ceff9d23c6f3 modules=sd-mod,usb-storage,ext4 rootfstype=ext4 console=ttyS0,115200</code></pre>
<ol start="3" type="1">
<li><p>Reboot and reconnect to vm</p></li>
<li><p>modify repositories</p></li>
</ol>
<pre><code>#/etc/apk/repositories

#/media/cdrom/apks
http://dl-cdn.alpinelinux.org/alpine/v3.11/main
http://dl-cdn.alpinelinux.org/alpine/v3.11/community
#http://dl-cdn.alpinelinux.org/alpine/edge/main
#http://dl-cdn.alpinelinux.org/alpine/edge/community
#http://dl-cdn.alpinelinux.org/alpine/edge/testing</code></pre>
<ol start="5" type="1">
<li>update repos</li>
</ol>
<pre><code>apk update

apk add util-linux</code></pre>
<ol start="6" type="1">
<li>Add user and groups</li>
</ol>
<pre><code># add some user e.g. named &quot;general&quot;
adduser general
# install sudo package
apk add sudo

# add user to groups
for u in $(ls /home); do for g in disk lp floppy audio cdrom dialout video netdev games users wheel; do addgroup $u $g; done;done

# edit sudoers file to allow users of group wheel
sed -i &#39;s/# %wheel ALL=(ALL) ALL/%wheel ALL=(ALL) ALL/g&#39; /etc
/sudoers</code></pre>
<ol start="7" type="1">
<li>Modify <code>/etc/ssh/sshd_config</code></li>
</ol>
<div class="sourceCode" id="cb14"><pre class="sourceCode ini"><code class="sourceCode ini"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#   $OpenBSD: sshd_config,v 1.103 2018/04/09 20:41:22 tj Exp $</span></span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="co"># This is the sshd server system-wide configuration file.  See</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># sshd_config(5) for more information.</span></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co"># This sshd was compiled with PATH=/bin:/usr/bin:/sbin:/usr/sbin</span></span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># The strategy used for options in the default sshd_config shipped with</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="co"># OpenSSH is to specify options with their default value where</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co"># possible, but leave them commented.  Uncommented options override the</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co"># default value.</span></span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="dt">Port 22</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">#AddressFamily any</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">#ListenAddress 0.0.0.0</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">#ListenAddress ::</span></span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a><span class="co">#HostKey /etc/ssh/ssh_host_rsa_key</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="co">#HostKey /etc/ssh/ssh_host_ecdsa_key</span></span>
<span id="cb14-20"><a href="#cb14-20"></a><span class="co">#HostKey /etc/ssh/ssh_host_ed25519_key</span></span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-22"><a href="#cb14-22"></a><span class="co"># Ciphers and keying</span></span>
<span id="cb14-23"><a href="#cb14-23"></a><span class="co">#RekeyLimit default none</span></span>
<span id="cb14-24"><a href="#cb14-24"></a></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co"># Logging</span></span>
<span id="cb14-26"><a href="#cb14-26"></a><span class="co">#SyslogFacility AUTH</span></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="co">#LogLevel INFO</span></span>
<span id="cb14-28"><a href="#cb14-28"></a></span>
<span id="cb14-29"><a href="#cb14-29"></a><span class="co"># Authentication:</span></span>
<span id="cb14-30"><a href="#cb14-30"></a></span>
<span id="cb14-31"><a href="#cb14-31"></a><span class="co">#LoginGraceTime 2m</span></span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="co">#PermitRootLogin prohibit-password</span></span>
<span id="cb14-33"><a href="#cb14-33"></a><span class="co">#StrictModes yes</span></span>
<span id="cb14-34"><a href="#cb14-34"></a><span class="co">#MaxAuthTries 6</span></span>
<span id="cb14-35"><a href="#cb14-35"></a><span class="co">#MaxSessions 10</span></span>
<span id="cb14-36"><a href="#cb14-36"></a></span>
<span id="cb14-37"><a href="#cb14-37"></a><span class="dt">PubkeyAuthentication yes</span></span>
<span id="cb14-38"><a href="#cb14-38"></a></span>
<span id="cb14-39"><a href="#cb14-39"></a><span class="co"># The default is to check both .ssh/authorized_keys and .ssh/authorized_keys2</span></span>
<span id="cb14-40"><a href="#cb14-40"></a><span class="co"># but this is overridden so installations will only check .ssh/authorized_keys</span></span>
<span id="cb14-41"><a href="#cb14-41"></a><span class="dt">AuthorizedKeysFile  .ssh/authorized_keys</span></span>
<span id="cb14-42"><a href="#cb14-42"></a></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="co">#AuthorizedPrincipalsFile none</span></span>
<span id="cb14-44"><a href="#cb14-44"></a></span>
<span id="cb14-45"><a href="#cb14-45"></a><span class="co">#AuthorizedKeysCommand none</span></span>
<span id="cb14-46"><a href="#cb14-46"></a><span class="co">#AuthorizedKeysCommandUser nobody</span></span>
<span id="cb14-47"><a href="#cb14-47"></a></span>
<span id="cb14-48"><a href="#cb14-48"></a><span class="co"># For this to work you will also need host keys in /etc/ssh/ssh_known_hosts</span></span>
<span id="cb14-49"><a href="#cb14-49"></a><span class="co">#HostbasedAuthentication no</span></span>
<span id="cb14-50"><a href="#cb14-50"></a><span class="co"># Change to yes if you don&#39;t trust ~/.ssh/known_hosts for</span></span>
<span id="cb14-51"><a href="#cb14-51"></a><span class="co"># HostbasedAuthentication</span></span>
<span id="cb14-52"><a href="#cb14-52"></a><span class="co">#IgnoreUserKnownHosts no</span></span>
<span id="cb14-53"><a href="#cb14-53"></a><span class="co"># Don&#39;t read the user&#39;s ~/.rhosts and ~/.shosts files</span></span>
<span id="cb14-54"><a href="#cb14-54"></a><span class="co">#IgnoreRhosts yes</span></span>
<span id="cb14-55"><a href="#cb14-55"></a></span>
<span id="cb14-56"><a href="#cb14-56"></a><span class="co"># To disable tunneled clear text passwords, change to no here!</span></span>
<span id="cb14-57"><a href="#cb14-57"></a><span class="co">#PasswordAuthentication yes</span></span>
<span id="cb14-58"><a href="#cb14-58"></a><span class="co">#PermitEmptyPasswords no</span></span>
<span id="cb14-59"><a href="#cb14-59"></a></span>
<span id="cb14-60"><a href="#cb14-60"></a><span class="co"># Change to no to disable s/key passwords</span></span>
<span id="cb14-61"><a href="#cb14-61"></a><span class="co">#ChallengeResponseAuthentication yes</span></span>
<span id="cb14-62"><a href="#cb14-62"></a></span>
<span id="cb14-63"><a href="#cb14-63"></a><span class="co"># Kerberos options</span></span>
<span id="cb14-64"><a href="#cb14-64"></a><span class="co">#KerberosAuthentication no</span></span>
<span id="cb14-65"><a href="#cb14-65"></a><span class="co">#KerberosOrLocalPasswd yes</span></span>
<span id="cb14-66"><a href="#cb14-66"></a><span class="co">#KerberosTicketCleanup yes</span></span>
<span id="cb14-67"><a href="#cb14-67"></a><span class="co">#KerberosGetAFSToken no</span></span>
<span id="cb14-68"><a href="#cb14-68"></a></span>
<span id="cb14-69"><a href="#cb14-69"></a><span class="co"># GSSAPI options</span></span>
<span id="cb14-70"><a href="#cb14-70"></a><span class="co">#GSSAPIAuthentication no</span></span>
<span id="cb14-71"><a href="#cb14-71"></a><span class="co">#GSSAPICleanupCredentials yes</span></span>
<span id="cb14-72"><a href="#cb14-72"></a></span>
<span id="cb14-73"><a href="#cb14-73"></a><span class="co"># Set this to &#39;yes&#39; to enable PAM authentication, account processing,</span></span>
<span id="cb14-74"><a href="#cb14-74"></a><span class="co"># and session processing. If this is enabled, PAM authentication will</span></span>
<span id="cb14-75"><a href="#cb14-75"></a><span class="co"># be allowed through the ChallengeResponseAuthentication and</span></span>
<span id="cb14-76"><a href="#cb14-76"></a><span class="co"># PasswordAuthentication.  Depending on your PAM configuration,</span></span>
<span id="cb14-77"><a href="#cb14-77"></a><span class="co"># PAM authentication via ChallengeResponseAuthentication may bypass</span></span>
<span id="cb14-78"><a href="#cb14-78"></a><span class="co"># the setting of &quot;PermitRootLogin without-password&quot;.</span></span>
<span id="cb14-79"><a href="#cb14-79"></a><span class="co"># If you just want the PAM account and session checks to run without</span></span>
<span id="cb14-80"><a href="#cb14-80"></a><span class="co"># PAM authentication, then enable this but set PasswordAuthentication</span></span>
<span id="cb14-81"><a href="#cb14-81"></a><span class="co"># and ChallengeResponseAuthentication to &#39;no&#39;.</span></span>
<span id="cb14-82"><a href="#cb14-82"></a><span class="co">#UsePAM no</span></span>
<span id="cb14-83"><a href="#cb14-83"></a></span>
<span id="cb14-84"><a href="#cb14-84"></a><span class="co">#AllowAgentForwarding yes</span></span>
<span id="cb14-85"><a href="#cb14-85"></a><span class="co"># Feel free to re-enable these if your use case requires them.</span></span>
<span id="cb14-86"><a href="#cb14-86"></a><span class="dt">AllowTcpForwarding no</span></span>
<span id="cb14-87"><a href="#cb14-87"></a><span class="dt">GatewayPorts no</span></span>
<span id="cb14-88"><a href="#cb14-88"></a><span class="dt">X11Forwarding no</span></span>
<span id="cb14-89"><a href="#cb14-89"></a><span class="co">#X11DisplayOffset 10</span></span>
<span id="cb14-90"><a href="#cb14-90"></a><span class="co">#X11UseLocalhost yes</span></span>
<span id="cb14-91"><a href="#cb14-91"></a><span class="co">#PermitTTY yes</span></span>
<span id="cb14-92"><a href="#cb14-92"></a><span class="co">#PrintMotd yes</span></span>
<span id="cb14-93"><a href="#cb14-93"></a><span class="co">#PrintLastLog yes</span></span>
<span id="cb14-94"><a href="#cb14-94"></a><span class="co">#TCPKeepAlive yes</span></span>
<span id="cb14-95"><a href="#cb14-95"></a><span class="co">#PermitUserEnvironment no</span></span>
<span id="cb14-96"><a href="#cb14-96"></a><span class="co">#Compression delayed</span></span>
<span id="cb14-97"><a href="#cb14-97"></a><span class="co">#ClientAliveInterval 0</span></span>
<span id="cb14-98"><a href="#cb14-98"></a><span class="co">#ClientAliveCountMax 3</span></span>
<span id="cb14-99"><a href="#cb14-99"></a><span class="co">#UseDNS no</span></span>
<span id="cb14-100"><a href="#cb14-100"></a><span class="co">#PidFile /run/sshd.pid</span></span>
<span id="cb14-101"><a href="#cb14-101"></a><span class="co">#MaxStartups 10:30:100</span></span>
<span id="cb14-102"><a href="#cb14-102"></a><span class="co">#PermitTunnel no</span></span>
<span id="cb14-103"><a href="#cb14-103"></a><span class="co">#ChrootDirectory none</span></span>
<span id="cb14-104"><a href="#cb14-104"></a><span class="co">#VersionAddendum none</span></span>
<span id="cb14-105"><a href="#cb14-105"></a></span>
<span id="cb14-106"><a href="#cb14-106"></a><span class="co"># no default banner path</span></span>
<span id="cb14-107"><a href="#cb14-107"></a><span class="co">#Banner none</span></span>
<span id="cb14-108"><a href="#cb14-108"></a></span>
<span id="cb14-109"><a href="#cb14-109"></a><span class="co"># override default of no subsystems</span></span>
<span id="cb14-110"><a href="#cb14-110"></a><span class="dt">Subsystem   sftp    /usr/lib/ssh/sftp-server</span></span>
<span id="cb14-111"><a href="#cb14-111"></a></span>
<span id="cb14-112"><a href="#cb14-112"></a><span class="co"># Example of overriding settings on a per-user basis</span></span>
<span id="cb14-113"><a href="#cb14-113"></a><span class="co">#Match User anoncvs</span></span>
<span id="cb14-114"><a href="#cb14-114"></a><span class="co">#   X11Forwarding no</span></span>
<span id="cb14-115"><a href="#cb14-115"></a><span class="co">#   AllowTcpForwarding no</span></span>
<span id="cb14-116"><a href="#cb14-116"></a><span class="co">#   PermitTTY no</span></span>
<span id="cb14-117"><a href="#cb14-117"></a><span class="co">#   ForceCommand cvs server</span></span>
<span id="cb14-118"><a href="#cb14-118"></a></span>
<span id="cb14-119"><a href="#cb14-119"></a><span class="dt">Match User general</span></span>
<span id="cb14-120"><a href="#cb14-120"></a><span class="dt">    PasswordAuthentication no</span></span>
<span id="cb14-121"><a href="#cb14-121"></a><span class="dt">    PubkeyAuthentication yes</span></span>
<span id="cb14-122"><a href="#cb14-122"></a><span class="dt">    AuthenticationMethods publickey</span></span></code></pre></div>
<p>add authorized keys from your workstation (e.g. copy and paste it)</p>
<pre><code>echo &quot;ssh-ed25519 SD323f928392i31sadfklsjdf37824 someone@some-workstation&quot; &gt; authorized_keys</code></pre>
<p>Login to the alpine machine from your workstation which is more comfortable</p>
<h2 id="create-new-disk-on-alpine">Create new disk on alpine</h2>
<div class="sourceCode" id="cb16"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># change to root</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="fu">sudo</span> -s</span>
<span id="cb16-3"><a href="#cb16-3"></a></span>
<span id="cb16-4"><a href="#cb16-4"></a><span class="co"># install linux utils</span></span>
<span id="cb16-5"><a href="#cb16-5"></a><span class="ex">apk</span> add util-linux</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="co"># check the disks</span></span>
<span id="cb16-8"><a href="#cb16-8"></a><span class="ex">lsblk</span></span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a><span class="co"># use parted, so install it</span></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="ex">apk</span> add parted</span>
<span id="cb16-12"><a href="#cb16-12"></a></span>
<span id="cb16-13"><a href="#cb16-13"></a><span class="co"># execute parted (in my case with vdb</span></span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="ex">parted</span> vdb</span>
<span id="cb16-15"><a href="#cb16-15"></a></span>
<span id="cb16-16"><a href="#cb16-16"></a><span class="co"># configure new gpt label</span></span>
<span id="cb16-17"><a href="#cb16-17"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mklabel</span> gpt</span>
<span id="cb16-18"><a href="#cb16-18"></a></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co"># set unit size</span></span>
<span id="cb16-20"><a href="#cb16-20"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">unit</span> MiB</span>
<span id="cb16-21"><a href="#cb16-21"></a></span>
<span id="cb16-22"><a href="#cb16-22"></a><span class="co"># make new ext4 partition</span></span>
<span id="cb16-23"><a href="#cb16-23"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">mkpart</span> 1 ext4 1 20479</span>
<span id="cb16-24"><a href="#cb16-24"></a></span>
<span id="cb16-25"><a href="#cb16-25"></a><span class="co"># check optimal alignment</span></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">align-check</span> opt</span>
<span id="cb16-27"><a href="#cb16-27"></a></span>
<span id="cb16-28"><a href="#cb16-28"></a><span class="co"># name partition e.g. &quot;data&quot;</span></span>
<span id="cb16-29"><a href="#cb16-29"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">name</span> 1 data</span>
<span id="cb16-30"><a href="#cb16-30"></a></span>
<span id="cb16-31"><a href="#cb16-31"></a><span class="co"># quit</span></span>
<span id="cb16-32"><a href="#cb16-32"></a><span class="kw">(</span><span class="ex">parted</span><span class="kw">)</span> <span class="ex">quit</span></span>
<span id="cb16-33"><a href="#cb16-33"></a></span>
<span id="cb16-34"><a href="#cb16-34"></a><span class="co"># make new filesystem</span></span>
<span id="cb16-35"><a href="#cb16-35"></a><span class="ex">mkfs.ext4</span> /dev/vdb1</span>
<span id="cb16-36"><a href="#cb16-36"></a></span>
<span id="cb16-37"><a href="#cb16-37"></a><span class="co"># not the partition UUID that mkfs reports, copy it</span></span>
<span id="cb16-38"><a href="#cb16-38"></a><span class="va">DATA_UUID=</span><span class="op">&lt;</span><span class="ex">your</span> partition uuid that you copied<span class="op">&gt;</span></span>
<span id="cb16-39"><a href="#cb16-39"></a></span>
<span id="cb16-40"><a href="#cb16-40"></a><span class="co"># create mount point directory</span></span>
<span id="cb16-41"><a href="#cb16-41"></a><span class="fu">mkdir</span> /data</span>
<span id="cb16-42"><a href="#cb16-42"></a></span>
<span id="cb16-43"><a href="#cb16-43"></a><span class="co"># add mounting into fstab</span></span>
<span id="cb16-44"><a href="#cb16-44"></a><span class="bu">echo</span> <span class="st">&quot;UUID=</span><span class="va">$DATA_UUID</span><span class="st"> /data ext4 rw,relatime,user 0 0&quot;</span> <span class="op">&gt;&gt;</span> /etc/fstab </span>
<span id="cb16-45"><a href="#cb16-45"></a></span>
<span id="cb16-46"><a href="#cb16-46"></a><span class="co"># mount it</span></span>
<span id="cb16-47"><a href="#cb16-47"></a><span class="fu">mount</span> /data</span></code></pre></div>
<h2 id="docker-on-a-separate-disk">Docker on a separate disk</h2>
<p>Install Docker</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb17-1"><a href="#cb17-1"></a><span class="fu">sudo</span> apk add docker</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">sudo</span> adduser general docker</span></code></pre></div>
<p>Modify <code>DOCKER_OPTS</code> in <code>/etc/conf.d/docker</code></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1"></a></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># any other random options you want to pass to docker</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="va">DOCKER_OPTS=</span><span class="st">&quot;--data-root /data/docker&quot;</span></span></code></pre></div>
<p>Restart Docker via <code>rc-service docker restart</code></p>

  </div>

   
      
      <section id="isso-thread"></section>
      
  

  

</article>

      </div>
    </main>

    <footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Hermes Technology Blog</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Hermes Technology Blog</li><li><a class="u-email" href="mailto:mail@hermes-technology.de">mail@hermes-technology.de</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/JanSurft"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">JanSurft</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>This is a blog about technology. I will write about the experiences I encounter, when working on my server infrastructure, building roboter(s), or developing any kind of software on the way.
</p>
      </div>
    </div>

  </div>

</footer>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="/js/toc.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
   $(document).ready(function() {
      $('#toc').toc({
     listType: 'ul',
   });
    });
</script>
  </body>

</html>
